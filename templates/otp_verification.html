{% extends "base.html" %}

{% block title %}OTP Verification{% endblock %}

{% block content %}
<div class="verification-container">
    <div class="verification-card">
        <div class="verification-header">
            <div class="verification-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
                </svg>
            </div>
            <h2>Two-Factor Verification</h2>
            <p>Enter the 6-digit code sent to your email</p>
        </div>
        
        <form method="POST" class="verification-form">
            {{ form.hidden_tag() }}
            
            <div class="otp-input-group">
                {{ form.otp.label(class="form-label") }}
                <div class="otp-fields">
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric" autofocus>
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric">
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric">
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric">
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric">
                    <input type="text" maxlength="1" pattern="\d" inputmode="numeric">
                </div>
                {{ form.otp(class="d-none") }}
            </div>
            
            <div class="form-group">
                {{ form.submit(class="btn btn-gate-success w-100") }}
            </div>
        </form>
        
        <div class="verification-footer">
            <p class="text-center">
                Didn't receive code? <a href="#">Resend</a>
            </p>
            <div class="security-timer">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.956 7.956 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
                    <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
                    <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
                </svg>
                <span id="countdown">05:00</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // OTP input fields
    const otpFields = document.querySelectorAll('.otp-fields input');
    const hiddenOtpInput = document.querySelector('input[name="otp"]');
    
    otpFields.forEach((field, index) => {
        field.addEventListener('input', function() {
            if (this.value.length === 1) {
                if (index < otpFields.length - 1) {
                    otpFields[index + 1].focus();
                } else {
                    this.blur();
                }
            }
            updateHiddenInput();
        });
        
        field.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                otpFields[index - 1].focus();
            }
        });
    });
    
    function updateHiddenInput() {
        let otp = '';
        otpFields.forEach(field => {
            otp += field.value;
        });
        hiddenOtpInput.value = otp;
    }
    
    // Countdown timer
    let timeLeft = 5 * 60; // 5 minutes in seconds
    const countdownElement = document.getElementById('countdown');
    
    const timer = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        
        countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            countdownElement.textContent = "Expired";
            countdownElement.classList.add("text-danger");
        } else {
            timeLeft--;
        }
    }, 1000);
});
</script>
{% endblock %}
