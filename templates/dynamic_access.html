{% extends "base.html" %}

{% block title %}Dynamic Access Code{% endblock %}

{% block content %}
<div class="dynamic-container">
    <div class="dynamic-card">
        <div class="dynamic-header">
            <h2>One-Time Access Code</h2>
            <p>Share this code securely with your partner</p>
        </div>
        
        <div class="dynamic-code-display">
            <div class="code-visual">
                <div class="code-text">{{ dynamic_code }}</div>
                <button class="btn btn-sm btn-outline-secondary copy-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                    </svg>
                    Copy
                </button>
            </div>
            
            <div class="qr-code">
                <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code">
            </div>
        </div>
        
        <form method="POST" class="dynamic-form">
            {{ form.hidden_tag() }}
            
            <div class="form-group">
                {{ form.access_code.label(class="form-label") }}
                <div class="input-group">
                    {{ form.access_code(class="form-control") }}
                    <button class="btn btn-outline-secondary paste-btn" type="button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/>
                        </svg>
                        Paste
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                {{ form.submit(class="btn btn-gate-warning w-100") }}
            </div>
        </form>
        
        <div class="dynamic-footer">
            <div class="security-info">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                </svg>
                <small>This code will expire after use or in 15 minutes</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Copy button
    document.querySelector('.copy-btn').addEventListener('click', function() {
        const code = '{{ dynamic_code }}';
        navigator.clipboard.writeText(code).then(() => {
            const originalText = this.innerHTML;
            this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/></svg> Copied!';
            setTimeout(() => {
                this.innerHTML = originalText;
            }, 2000);
        });
    });
    
    // Paste button
    document.querySelector('.paste-btn').addEventListener('click', async function() {
        try {
            const text = await navigator.clipboard.readText();
            document.querySelector('input[name="access_code"]').value = text;
        } catch (err) {
            alert('Failed to read clipboard contents');
        }
    });
});
</script>
{% endblock %}
